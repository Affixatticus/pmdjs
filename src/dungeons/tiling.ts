type CropParams = [number, number, number, number];

/** Value to index each type of tiling encounterable */
export enum Tilings {
    NORTH_WEST_FULL,
    NORTH_FULL,
    NORTH_EAST_FULL,
    WEST_FULL,
    CENTER_FULL,
    EAST_FULL,
    SOUTH_WEST_FULL,
    SOUTH_FULL,
    SOUTH_EAST_FULL,

    SOUTH_TO_EAST_JUNCTION_THIN,
    HORIZONTAL_THIN,
    SOUTH_TO_WEST_JUNCTION_THIN,
    VERTICAL_THIN,
    CENTER_THIN,
    ___UNUSED_1___,
    NORTH_TO_EAST_JUNCTION_THIN,
    ___UNUSED_2___,
    NORTH_TO_WEST_JUNCTION_THIN,

    ___UNUSED_3___,
    END_NORTH_JUNCTION_THIN,
    ___UNUSED_4___,
    END_WEST_JUNCTION_THIN,
    FOUR_WAY_JUNCTION_THIN,
    END_EAST_JUNCTION_THIN,
    ___UNUSED_5___,
    END_SOUTH_JUNCTION_THIN,
    ___UNUSED_6___,

    ___UNUSED_7___,
    HORIZONTAL_TO_SOUTH_JUNCTION_THIN,
    ___UNUSED_8___,
    VERTICAL_TO_EAST_JUNCTION_THIN,
    ___UNUSED_9___,
    VERTICAL_TO_WEST_JUNCTION_THIN,
    ___UNUSED_10___,
    HORIZONTAL_TO_NORTH_JUNCTION_THIN,
    ___UNUSED_11___,

    ___UNUSED_12___,
    NORTH_TO_SOUTH_JUNCTIONS_FULL,
    ___UNUSED_13___,
    WEST_TO_EAST_JUNCTIONS_FULL,
    ___UNUSED_14___,
    EAST_TO_WEST_JUNCTIONS_FULL,
    ___UNUSED_15___,
    SOUTH_TO_NORTH_JUNCTIONS_FULL,
    ___UNUSED_16___,

    SOUTH_EAST_CORNER_EMPTY,
    SOUTH_WEST_CORNER_EMPTY,
    ___UNUSED_17___,
    NORTH_EAST_CORNER_EMPTY,
    NORTH_WEST_CORNER_EMPTY,
    ___UNUSED_18___,

    VERTICAL_TO_SOUTH_EAST_FULL,
    VERTICAL_TO_SOUTH_WEST_FULL,
    ___UNUSED_19___,
    VERTICAL_TO_NORTH_EAST_FULL,
    VERTICAL_TO_NORTH_WEST_FULL,
    ___UNUSED_20___,

    HORIZONTAL_TO_SOUTH_EAST_FULL,
    HORIZONTAL_TO_SOUTH_WEST_FULL,
    ___UNUSED_21___,
    HORIZONTAL_TO_NORTH_EAST_FULL,
    HORIZONTAL_TO_NORTH_WEST_FULL,
    ___UNUSED_22___,

    ALL_JUNCTION_TO_SOUTH_EAST_FULL,
    ALL_JUNCTION_TO_SOUTH_WEST_FULL,
    ___UNUSED_23___,
    ALL_JUNCTION_TO_NORTH_EAST_FULL,
    ALL_JUNCTION_TO_NORTH_WEST_FULL,
    ___UNUSED_24___,

    FULL_TO_SOUTH_EAST_AND_OPPOSITE,
    FULL_TO_SOUTH_WEST_AND_OPPOSITE,
    ___UNUSED_25___,

    UNDEFINED = 255,
}

const NeighborsLookupTable: Record<string, Tilings> = {
    "01111110": Tilings.FULL_TO_SOUTH_WEST_AND_OPPOSITE,
    "11011011": Tilings.FULL_TO_SOUTH_EAST_AND_OPPOSITE,

    "01011011": Tilings.ALL_JUNCTION_TO_SOUTH_EAST_FULL,
    "01011110": Tilings.ALL_JUNCTION_TO_SOUTH_WEST_FULL,
    "01111010": Tilings.ALL_JUNCTION_TO_NORTH_EAST_FULL,
    "11011010": Tilings.ALL_JUNCTION_TO_NORTH_WEST_FULL,

    "01101010": Tilings.VERTICAL_TO_SOUTH_EAST_FULL,
    "01101110": Tilings.VERTICAL_TO_SOUTH_EAST_FULL,
    "11101010": Tilings.VERTICAL_TO_SOUTH_EAST_FULL,
    "11101110": Tilings.VERTICAL_TO_SOUTH_EAST_FULL,

    "11010010": Tilings.VERTICAL_TO_SOUTH_WEST_FULL,
    "11010011": Tilings.VERTICAL_TO_SOUTH_WEST_FULL,
    "11110010": Tilings.VERTICAL_TO_SOUTH_WEST_FULL,
    "11110011": Tilings.VERTICAL_TO_SOUTH_WEST_FULL,

    "01001011": Tilings.VERTICAL_TO_NORTH_EAST_FULL,
    "01001111": Tilings.VERTICAL_TO_NORTH_EAST_FULL,
    "11001011": Tilings.VERTICAL_TO_NORTH_EAST_FULL,
    "11001111": Tilings.VERTICAL_TO_NORTH_EAST_FULL,

    "01010110": Tilings.VERTICAL_TO_NORTH_WEST_FULL,
    "01010111": Tilings.VERTICAL_TO_NORTH_WEST_FULL,
    "01110110": Tilings.VERTICAL_TO_NORTH_WEST_FULL,
    "01110111": Tilings.VERTICAL_TO_NORTH_WEST_FULL,

    "00011110": Tilings.HORIZONTAL_TO_SOUTH_EAST_FULL,
    "00111110": Tilings.HORIZONTAL_TO_SOUTH_EAST_FULL,
    "10011110": Tilings.HORIZONTAL_TO_SOUTH_EAST_FULL,
    "10111110": Tilings.HORIZONTAL_TO_SOUTH_EAST_FULL,

    "00011011": Tilings.HORIZONTAL_TO_SOUTH_WEST_FULL,
    "00111011": Tilings.HORIZONTAL_TO_SOUTH_WEST_FULL,
    "10011011": Tilings.HORIZONTAL_TO_SOUTH_WEST_FULL,
    "10111011": Tilings.HORIZONTAL_TO_SOUTH_WEST_FULL,

    "11011000": Tilings.HORIZONTAL_TO_NORTH_EAST_FULL,
    "11011001": Tilings.HORIZONTAL_TO_NORTH_EAST_FULL,
    "11011100": Tilings.HORIZONTAL_TO_NORTH_EAST_FULL,
    "11011101": Tilings.HORIZONTAL_TO_NORTH_EAST_FULL,

    "01111000": Tilings.HORIZONTAL_TO_NORTH_WEST_FULL,
    "01111001": Tilings.HORIZONTAL_TO_NORTH_WEST_FULL,
    "01111100": Tilings.HORIZONTAL_TO_NORTH_WEST_FULL,
    "01111101": Tilings.HORIZONTAL_TO_NORTH_WEST_FULL,

    "11111010": Tilings.NORTH_TO_SOUTH_JUNCTIONS_FULL,
    "01111011": Tilings.EAST_TO_WEST_JUNCTIONS_FULL,
    "01011111": Tilings.SOUTH_TO_NORTH_JUNCTIONS_FULL,
    "11011110": Tilings.WEST_TO_EAST_JUNCTIONS_FULL,

    "00011010": Tilings.HORIZONTAL_TO_SOUTH_JUNCTION_THIN,
    "00111010": Tilings.HORIZONTAL_TO_SOUTH_JUNCTION_THIN,
    "10011010": Tilings.HORIZONTAL_TO_SOUTH_JUNCTION_THIN,
    "10111010": Tilings.HORIZONTAL_TO_SOUTH_JUNCTION_THIN,

    "01011000": Tilings.HORIZONTAL_TO_NORTH_JUNCTION_THIN,
    "01011001": Tilings.HORIZONTAL_TO_NORTH_JUNCTION_THIN,
    "01011100": Tilings.HORIZONTAL_TO_NORTH_JUNCTION_THIN,
    "01011101": Tilings.HORIZONTAL_TO_NORTH_JUNCTION_THIN,

    "01010010": Tilings.VERTICAL_TO_WEST_JUNCTION_THIN,
    "01010011": Tilings.VERTICAL_TO_WEST_JUNCTION_THIN,
    "01110010": Tilings.VERTICAL_TO_WEST_JUNCTION_THIN,
    "01110011": Tilings.VERTICAL_TO_WEST_JUNCTION_THIN,

    "01001010": Tilings.VERTICAL_TO_EAST_JUNCTION_THIN,
    "01001110": Tilings.VERTICAL_TO_EAST_JUNCTION_THIN,
    "11001010": Tilings.VERTICAL_TO_EAST_JUNCTION_THIN,
    "11001110": Tilings.VERTICAL_TO_EAST_JUNCTION_THIN,

    "00011111": Tilings.NORTH_FULL,
    "00111111": Tilings.NORTH_FULL,
    "10011111": Tilings.NORTH_FULL,
    "10111111": Tilings.NORTH_FULL,

    "01101011": Tilings.WEST_FULL,
    "01101111": Tilings.WEST_FULL,
    "11101011": Tilings.WEST_FULL,

    "11111111": Tilings.CENTER_FULL,

    "11010110": Tilings.EAST_FULL,
    "11010111": Tilings.EAST_FULL,
    "11110110": Tilings.EAST_FULL,
    "11110111": Tilings.EAST_FULL,

    "11111000": Tilings.SOUTH_FULL,
    "11111001": Tilings.SOUTH_FULL,
    "11111100": Tilings.SOUTH_FULL,
    "11111101": Tilings.SOUTH_FULL,

    "00001011": Tilings.NORTH_WEST_FULL,
    "00001111": Tilings.NORTH_WEST_FULL,
    "00101011": Tilings.NORTH_WEST_FULL,
    "00101111": Tilings.NORTH_WEST_FULL,
    "10001011": Tilings.NORTH_WEST_FULL,
    "10001111": Tilings.NORTH_WEST_FULL,
    "10101011": Tilings.NORTH_WEST_FULL,
    "10101111": Tilings.NORTH_WEST_FULL,

    "00010110": Tilings.NORTH_EAST_FULL,
    "00010111": Tilings.NORTH_EAST_FULL,
    "00110110": Tilings.NORTH_EAST_FULL,
    "00110111": Tilings.NORTH_EAST_FULL,
    "10010110": Tilings.NORTH_EAST_FULL,
    "10010111": Tilings.NORTH_EAST_FULL,
    "10110110": Tilings.NORTH_EAST_FULL,
    "10110111": Tilings.NORTH_EAST_FULL,

    "01101000": Tilings.SOUTH_WEST_FULL,
    "01101001": Tilings.SOUTH_WEST_FULL,
    "01101100": Tilings.SOUTH_WEST_FULL,
    "01101101": Tilings.SOUTH_WEST_FULL,
    "11101000": Tilings.SOUTH_WEST_FULL,
    "11101001": Tilings.SOUTH_WEST_FULL,
    "11101100": Tilings.SOUTH_WEST_FULL,
    "11101101": Tilings.SOUTH_WEST_FULL,

    "11010000": Tilings.SOUTH_EAST_FULL,
    "11010001": Tilings.SOUTH_EAST_FULL,
    "11010100": Tilings.SOUTH_EAST_FULL,
    "11010101": Tilings.SOUTH_EAST_FULL,
    "11110000": Tilings.SOUTH_EAST_FULL,
    "11110001": Tilings.SOUTH_EAST_FULL,
    "11110100": Tilings.SOUTH_EAST_FULL,
    "11110101": Tilings.SOUTH_EAST_FULL,


    "11111110": Tilings.SOUTH_EAST_CORNER_EMPTY,
    "11111011": Tilings.SOUTH_WEST_CORNER_EMPTY,
    "11011111": Tilings.NORTH_EAST_CORNER_EMPTY,
    "01111111": Tilings.NORTH_WEST_CORNER_EMPTY,

    "00001010": Tilings.SOUTH_TO_EAST_JUNCTION_THIN,
    "00001110": Tilings.SOUTH_TO_EAST_JUNCTION_THIN,
    "00101010": Tilings.SOUTH_TO_EAST_JUNCTION_THIN,
    "00101110": Tilings.SOUTH_TO_EAST_JUNCTION_THIN,
    "10001010": Tilings.SOUTH_TO_EAST_JUNCTION_THIN,
    "10001110": Tilings.SOUTH_TO_EAST_JUNCTION_THIN,
    "10101010": Tilings.SOUTH_TO_EAST_JUNCTION_THIN,
    "10101110": Tilings.SOUTH_TO_EAST_JUNCTION_THIN,

    "00010010": Tilings.SOUTH_TO_WEST_JUNCTION_THIN,
    "00010011": Tilings.SOUTH_TO_WEST_JUNCTION_THIN,
    "00110010": Tilings.SOUTH_TO_WEST_JUNCTION_THIN,
    "00110011": Tilings.SOUTH_TO_WEST_JUNCTION_THIN,
    "10010010": Tilings.SOUTH_TO_WEST_JUNCTION_THIN,
    "10010011": Tilings.SOUTH_TO_WEST_JUNCTION_THIN,
    "10110010": Tilings.SOUTH_TO_WEST_JUNCTION_THIN,
    "10110011": Tilings.SOUTH_TO_WEST_JUNCTION_THIN,

    "01001000": Tilings.NORTH_TO_EAST_JUNCTION_THIN,
    "01001001": Tilings.NORTH_TO_EAST_JUNCTION_THIN,
    "01001100": Tilings.NORTH_TO_EAST_JUNCTION_THIN,
    "01001101": Tilings.NORTH_TO_EAST_JUNCTION_THIN,
    "11001000": Tilings.NORTH_TO_EAST_JUNCTION_THIN,
    "11001001": Tilings.NORTH_TO_EAST_JUNCTION_THIN,
    "11001100": Tilings.NORTH_TO_EAST_JUNCTION_THIN,
    "11001101": Tilings.NORTH_TO_EAST_JUNCTION_THIN,

    "01010000": Tilings.NORTH_TO_WEST_JUNCTION_THIN,
    "01010001": Tilings.NORTH_TO_WEST_JUNCTION_THIN,
    "01010100": Tilings.NORTH_TO_WEST_JUNCTION_THIN,
    "01010101": Tilings.NORTH_TO_WEST_JUNCTION_THIN,
    "01110000": Tilings.NORTH_TO_WEST_JUNCTION_THIN,
    "01110001": Tilings.NORTH_TO_WEST_JUNCTION_THIN,
    "01110100": Tilings.NORTH_TO_WEST_JUNCTION_THIN,
    "01110101": Tilings.NORTH_TO_WEST_JUNCTION_THIN,

    "00011000": Tilings.HORIZONTAL_THIN,
    "00011001": Tilings.HORIZONTAL_THIN,
    "00011100": Tilings.HORIZONTAL_THIN,
    "00011101": Tilings.HORIZONTAL_THIN,
    "00111000": Tilings.HORIZONTAL_THIN,
    "00111001": Tilings.HORIZONTAL_THIN,
    "00111100": Tilings.HORIZONTAL_THIN,
    "00111101": Tilings.HORIZONTAL_THIN,
    "10011000": Tilings.HORIZONTAL_THIN,
    "10011001": Tilings.HORIZONTAL_THIN,
    "10011100": Tilings.HORIZONTAL_THIN,
    "10011101": Tilings.HORIZONTAL_THIN,
    "10111000": Tilings.HORIZONTAL_THIN,
    "10111001": Tilings.HORIZONTAL_THIN,
    "10111100": Tilings.HORIZONTAL_THIN,
    "10111101": Tilings.HORIZONTAL_THIN,

    "01000010": Tilings.VERTICAL_THIN,
    "01000011": Tilings.VERTICAL_THIN,
    "01000110": Tilings.VERTICAL_THIN,
    "01000111": Tilings.VERTICAL_THIN,
    "01100010": Tilings.VERTICAL_THIN,
    "01100011": Tilings.VERTICAL_THIN,
    "01100110": Tilings.VERTICAL_THIN,
    "01100111": Tilings.VERTICAL_THIN,
    "11000010": Tilings.VERTICAL_THIN,
    "11000011": Tilings.VERTICAL_THIN,
    "11000110": Tilings.VERTICAL_THIN,
    "11000111": Tilings.VERTICAL_THIN,
    "11100010": Tilings.VERTICAL_THIN,
    "11100011": Tilings.VERTICAL_THIN,
    "11100110": Tilings.VERTICAL_THIN,
    "11100111": Tilings.VERTICAL_THIN,

    "00000000": Tilings.CENTER_THIN,
    "00000001": Tilings.CENTER_THIN,
    "00000100": Tilings.CENTER_THIN,
    "00000101": Tilings.CENTER_THIN,
    "00100000": Tilings.CENTER_THIN,
    "00100001": Tilings.CENTER_THIN,
    "00100100": Tilings.CENTER_THIN,
    "00100101": Tilings.CENTER_THIN,
    "10000000": Tilings.CENTER_THIN,
    "10000001": Tilings.CENTER_THIN,
    "10000100": Tilings.CENTER_THIN,
    "10000101": Tilings.CENTER_THIN,
    "10100000": Tilings.CENTER_THIN,
    "10100001": Tilings.CENTER_THIN,
    "10100100": Tilings.CENTER_THIN,
    "10100101": Tilings.CENTER_THIN,

    "00000010": Tilings.END_NORTH_JUNCTION_THIN,
    "00000011": Tilings.END_NORTH_JUNCTION_THIN,
    "00000110": Tilings.END_NORTH_JUNCTION_THIN,
    "00000111": Tilings.END_NORTH_JUNCTION_THIN,
    "00100010": Tilings.END_NORTH_JUNCTION_THIN,
    "00100011": Tilings.END_NORTH_JUNCTION_THIN,
    "00100110": Tilings.END_NORTH_JUNCTION_THIN,
    "00100111": Tilings.END_NORTH_JUNCTION_THIN,
    "10000010": Tilings.END_NORTH_JUNCTION_THIN,
    "10000011": Tilings.END_NORTH_JUNCTION_THIN,
    "10000110": Tilings.END_NORTH_JUNCTION_THIN,
    "10000111": Tilings.END_NORTH_JUNCTION_THIN,
    "10100010": Tilings.END_NORTH_JUNCTION_THIN,
    "10100011": Tilings.END_NORTH_JUNCTION_THIN,
    "10100110": Tilings.END_NORTH_JUNCTION_THIN,
    "10100111": Tilings.END_NORTH_JUNCTION_THIN,

    "00001000": Tilings.END_WEST_JUNCTION_THIN,
    "00001001": Tilings.END_WEST_JUNCTION_THIN,
    "00001100": Tilings.END_WEST_JUNCTION_THIN,
    "00001101": Tilings.END_WEST_JUNCTION_THIN,
    "00101000": Tilings.END_WEST_JUNCTION_THIN,
    "00101001": Tilings.END_WEST_JUNCTION_THIN,
    "00101100": Tilings.END_WEST_JUNCTION_THIN,
    "00101101": Tilings.END_WEST_JUNCTION_THIN,
    "10001000": Tilings.END_WEST_JUNCTION_THIN,
    "10001001": Tilings.END_WEST_JUNCTION_THIN,
    "10001100": Tilings.END_WEST_JUNCTION_THIN,
    "10001101": Tilings.END_WEST_JUNCTION_THIN,
    "10101000": Tilings.END_WEST_JUNCTION_THIN,
    "10101001": Tilings.END_WEST_JUNCTION_THIN,
    "10101100": Tilings.END_WEST_JUNCTION_THIN,
    "10101101": Tilings.END_WEST_JUNCTION_THIN,

    "00010000": Tilings.END_EAST_JUNCTION_THIN,
    "00010001": Tilings.END_EAST_JUNCTION_THIN,
    "00010100": Tilings.END_EAST_JUNCTION_THIN,
    "00010101": Tilings.END_EAST_JUNCTION_THIN,
    "00110000": Tilings.END_EAST_JUNCTION_THIN,
    "00110001": Tilings.END_EAST_JUNCTION_THIN,
    "00110100": Tilings.END_EAST_JUNCTION_THIN,
    "00110101": Tilings.END_EAST_JUNCTION_THIN,
    "10010000": Tilings.END_EAST_JUNCTION_THIN,
    "10010001": Tilings.END_EAST_JUNCTION_THIN,
    "10010100": Tilings.END_EAST_JUNCTION_THIN,
    "10010101": Tilings.END_EAST_JUNCTION_THIN,
    "10110000": Tilings.END_EAST_JUNCTION_THIN,
    "10110001": Tilings.END_EAST_JUNCTION_THIN,
    "10110100": Tilings.END_EAST_JUNCTION_THIN,
    "10110101": Tilings.END_EAST_JUNCTION_THIN,

    "01000000": Tilings.END_SOUTH_JUNCTION_THIN,
    "01000001": Tilings.END_SOUTH_JUNCTION_THIN,
    "01000100": Tilings.END_SOUTH_JUNCTION_THIN,
    "01000101": Tilings.END_SOUTH_JUNCTION_THIN,
    "01100000": Tilings.END_SOUTH_JUNCTION_THIN,
    "01100001": Tilings.END_SOUTH_JUNCTION_THIN,
    "01100100": Tilings.END_SOUTH_JUNCTION_THIN,
    "01100101": Tilings.END_SOUTH_JUNCTION_THIN,
    "11000000": Tilings.END_SOUTH_JUNCTION_THIN,
    "11000001": Tilings.END_SOUTH_JUNCTION_THIN,
    "11000100": Tilings.END_SOUTH_JUNCTION_THIN,
    "11000101": Tilings.END_SOUTH_JUNCTION_THIN,
    "11100000": Tilings.END_SOUTH_JUNCTION_THIN,
    "11100001": Tilings.END_SOUTH_JUNCTION_THIN,
    "11100100": Tilings.END_SOUTH_JUNCTION_THIN,
    "11100101": Tilings.END_SOUTH_JUNCTION_THIN,

    "01011010": Tilings.FOUR_WAY_JUNCTION_THIN,
};

/** Helper class */
export class DungeonTiling {
    static getTiling(neighbors: boolean[]): number {
        return NeighborsLookupTable[neighbors.map(n => n ? "1" : "0").join("")] ?? Tilings.UNDEFINED;
    }

    static getWallsHeightmapCrop(tiling: Tilings): CropParams {
        // Each tile is a 24x24
        // The board is virtually 3 wide and infinitely tall
        const x = (tiling % 3) * 24;
        const y = Math.floor(tiling / 3) * 24;
        return [x, y, 24, 24];
    }

    static getWallsTexturesCrop(tiling: Tilings, variant: number): CropParams {
        const x = ((tiling % 3) + 3 * variant) * 24;
        const y = Math.floor(tiling / 3) * 24;
        return [x, y, 24, 24];
    }

    static getFloorCrop(tiling: Tilings, variant: number): CropParams {
        // Each tile is a 24x24
        // The board is virtually 3 wide and infinitely tall
        const x = ((tiling % 3) + 9 + 3 * variant) * 24;
        const y = Math.floor(tiling / 3) * 24;
        return [x, y, 24, 24];
    }
}